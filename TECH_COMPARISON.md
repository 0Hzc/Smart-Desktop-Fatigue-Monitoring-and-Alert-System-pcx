# 技术选型对比分析

## 一、人脸关键点检测方案对比

### 方案1: MediaPipe Face Mesh ⭐推荐
**优势**:
- ✅ **性能优秀**: 在树莓派上可达20+ FPS
- ✅ **轻量级**: 模型小（~10MB），资源占用低
- ✅ **关键点丰富**: 提供468个3D人脸关键点
- ✅ **Google支持**: 持续更新维护
- ✅ **易于使用**: API简单，pip直接安装
- ✅ **跨平台**: 支持ARM架构（树莓派）

**劣势**:
- ❌ 在极暗光环境下性能下降
- ❌ 侧脸角度>60度时精度降低

**适用场景**: 桌面正面使用场景（本项目最佳选择）

### 方案2: dlib + shape_predictor
**优势**:
- ✅ 经典稳定，社区资源丰富
- ✅ 68关键点模型精度高
- ✅ 开源免费

**劣势**:
- ❌ **性能差**: 树莓派上仅5-8 FPS
- ❌ 编译复杂，依赖多
- ❌ 模型文件大（99MB）
- ❌ 仅提供2D关键点

**结论**: ❌ 不推荐用于树莓派项目

### 方案3: OpenCV DNN + 预训练模型
**优势**:
- ✅ 可自定义模型
- ✅ OpenCV原生支持

**劣势**:
- ❌ 需要自己训练或寻找模型
- ❌ 关键点数量和精度不确定
- ❌ 部署复杂度高

**结论**: ❌ 不适合本项目

---

## 二、摄像头方案对比

### 方案1: Raspberry Pi Camera Module V2/V3 ⭐推荐
**参数**:
- 分辨率: 8MP (3280×2464)
- 视频: 1080p30 / 720p60
- 接口: CSI接口
- 价格: ~200元

**优势**:
- ✅ 官方支持，兼容性好
- ✅ 性能优秀，低延迟
- ✅ picamera2库易用
- ✅ 功耗低

**劣势**:
- ❌ 需要CSI接口（部分树莓派Zero没有）
- ❌ 视角固定（需手动调整）

### 方案2: USB摄像头
**优势**:
- ✅ 即插即用
- ✅ 便宜（50-100元）
- ✅ 可更换

**劣势**:
- ❌ USB带宽占用
- ❌ 延迟较高
- ❌ 兼容性参差不齐

**结论**: 推荐使用树莓派官方摄像头，备选USB摄像头

---

## 三、语音播报方案对比

### 方案1: pyttsx3 (离线) ⭐推荐
**优势**:
- ✅ 完全离线，无需网络
- ✅ 响应速度快（<100ms）
- ✅ 跨平台
- ✅ 免费

**劣势**:
- ❌ 中文语音质量一般
- ❌ 男声/女声选择少

**安装**: `pip install pyttsx3`

### 方案2: gTTS (在线)
**优势**:
- ✅ 语音质量好（Google TTS）
- ✅ 多语言支持

**劣势**:
- ❌ 需要网络连接
- ❌ 延迟高（1-3秒）
- ❌ 依赖Google服务

### 方案3: 百度/讯飞语音API
**优势**:
- ✅ 中文质量最好
- ✅ 可自定义音色

**劣势**:
- ❌ 需要注册账号
- ❌ 有调用限制
- ❌ 延迟较高

**推荐策略**:
- 主要使用pyttsx3（离线快速）
- 可选gTTS生成高质量语音缓存文件

---

## 四、GUI框架对比

### 方案1: Tkinter ⭐推荐
**优势**:
- ✅ Python内置，无需安装
- ✅ 轻量级，资源占用低
- ✅ 适合树莓派
- ✅ 学习成本低

**劣势**:
- ❌ 界面较简陋
- ❌ 自定义样式复杂

### 方案2: PyQt5
**优势**:
- ✅ 界面美观
- ✅ 功能强大
- ✅ 控件丰富

**劣势**:
- ❌ 安装包大（>100MB）
- ❌ 资源占用高
- ❌ 学习曲线陡峭

### 方案3: Kivy
**优势**:
- ✅ 现代化UI
- ✅ 触摸屏支持

**劣势**:
- ❌ 依赖复杂
- ❌ 在树莓派上性能一般

**结论**: Tkinter最适合本项目

---

## 五、数据存储方案

### 方案1: SQLite ⭐推荐
**优势**:
- ✅ 轻量级，无需服务器
- ✅ Python内置支持
- ✅ 支持SQL查询
- ✅ 数据结构清晰

**使用场景**: 用户数据、历史记录、统计信息

### 方案2: JSON文件
**优势**:
- ✅ 简单直观
- ✅ 易于调试
- ✅ 跨平台

**劣势**:
- ❌ 查询效率低
- ❌ 数据量大时性能差

**使用场景**: 配置文件、临时数据

### 方案3: CSV文件
**优势**:
- ✅ Excel可直接打开
- ✅ 数据导出方便

**使用场景**: 日志导出、报表生成

**推荐策略**:
- SQLite: 主要数据存储
- YAML: 配置文件
- JSON: 临时缓存
- CSV: 数据导出

---

## 六、树莓派型号选择

### Raspberry Pi 4B (4GB/8GB) ⭐最推荐
- CPU: 4核1.5GHz
- 内存: 4GB/8GB
- 预期帧率: 20-25 FPS
- 价格: ~500元

### Raspberry Pi 3B+
- CPU: 4核1.4GHz
- 内存: 1GB
- 预期帧率: 15-18 FPS
- 价格: ~300元

### Raspberry Pi Zero 2W
- CPU: 4核1.0GHz
- 内存: 512MB
- 预期帧率: 10-12 FPS（需深度优化）
- 价格: ~150元

**建议**: 使用树莓派4B (4GB)，性价比最高且性能充足

---

## 七、开发环境推荐

### 操作系统
- **Raspberry Pi OS (64-bit)** ⭐推荐
  - 官方支持最好
  - 软件包丰富
  - 社区资源多

### Python版本
- **Python 3.9-3.11** ⭐推荐
  - 3.9: 稳定性最好
  - 3.11: 性能提升15%

### 开发工具
- **远程开发**: VS Code + Remote SSH
- **本地编辑**: Thonny (树莓派预装)
- **版本控制**: Git

### 调试工具
- **性能分析**: cProfile, line_profiler
- **内存监控**: memory_profiler
- **FPS显示**: OpenCV内置工具

---

## 八、成本预算

| 项目 | 型号/规格 | 价格(CNY) |
|------|----------|----------|
| 主控 | 树莓派4B 4GB | 500 |
| 摄像头 | Pi Camera V2 | 200 |
| 电源 | 5V 3A官方电源 | 80 |
| 存储 | 32GB MicroSD卡 | 50 |
| LED灯 | 5mm红色LED×3 | 5 |
| 电阻 | 220Ω电阻×3 | 2 |
| 面包板 | 小型面包板 | 10 |
| 杜邦线 | 40根套装 | 8 |
| 外壳 | 亚克力外壳 | 30 |
| **总计** | | **~885元** |

**备注**: 如果已有树莓派，额外成本仅~300元

---

## 九、性能优化技巧

### 代码层面
1. **使用NumPy向量化操作**代替循环
2. **缓存重复计算**结果（如EAR阈值）
3. **延迟导入**非关键模块
4. **关闭调试输出**（如MediaPipe的绘图）

### 系统层面
1. **超频**: 树莓派4B可超频至2.0GHz
2. **禁用桌面环境**: 命令行模式运行
3. **关闭蓝牙/WiFi**: 如果不需要网络
4. **降低GPU内存**: 修改config.txt

### MediaPipe优化
```python
mp_face_mesh = mp.solutions.face_mesh
face_mesh = mp_face_mesh.FaceMesh(
    max_num_faces=1,              # 只检测1个人脸
    refine_landmarks=False,       # 不使用精细关键点
    min_detection_confidence=0.5, # 降低检测阈值
    min_tracking_confidence=0.5   # 降低跟踪阈值
)
```

---

## 十、常见问题FAQ

### Q1: MediaPipe在树莓派上安装失败？
**A**: 使用pip安装预编译版本
```bash
pip3 install mediapipe-rpi4
```

### Q2: 摄像头帧率低于预期？
**A**:
1. 降低分辨率至320x240
2. 检查USB供电是否充足（建议使用官方3A电源）
3. 关闭其他后台程序

### Q3: 中文语音播报失败？
**A**:
```bash
# 安装中文语音引擎
sudo apt-get install espeak
pip3 install pyttsx3
```

### Q4: GPIO权限错误？
**A**:
```bash
# 添加用户到gpio组
sudo usermod -a -G gpio $USER
# 重新登录生效
```

### Q5: OpenCV导入失败？
**A**:
```bash
# 安装依赖
sudo apt-get install libatlas-base-dev libjasper-dev libqt4-test
pip3 install opencv-python==4.8.1.78
```

---

**总结**: 本项目推荐技术栈为 **MediaPipe + OpenCV + Tkinter + pyttsx3 + SQLite**，在树莓派4B上可达到20+ FPS的流畅运行效果。
