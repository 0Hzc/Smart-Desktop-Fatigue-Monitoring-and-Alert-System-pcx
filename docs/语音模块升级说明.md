# è¯­éŸ³æ¨¡å—å‡çº§è¯´æ˜ï¼šä»pyttsx3è¿ç§»åˆ°espeak

## ğŸ“‹ å˜æ›´æ‘˜è¦

**æ—¥æœŸ**ï¼š2024å¹´11æœˆ
**ç‰ˆæœ¬**ï¼šv2.1
**å˜æ›´ç±»å‹**ï¼šä¾èµ–ä¼˜åŒ–

### å˜æ›´åŸå› 

åœ¨Ubuntu/Linuxç¯å¢ƒä¸‹å®‰è£…pyttsx3æ—¶é‡åˆ°ä¾èµ–é—®é¢˜ï¼š

```bash
ERROR: Could not find a version that satisfies the requirement pywin32==311
ERROR: No matching distribution found for pywin32==311
```

**æ ¹æœ¬åŸå› **ï¼š
- `pywin32`æ˜¯Windowsä¸“ç”¨çš„åŒ…ï¼Œåœ¨Linuxä¸Šä¸å¯ç”¨
- `pyttsx3`åœ¨Linuxä¸Šå®é™…ä¸Šåªæ˜¯å¯¹`espeak`çš„Pythonå°è£…
- ç›´æ¥ä½¿ç”¨`espeak`å¯ä»¥é¿å…ä¸å¿…è¦çš„è·¨å¹³å°ä¾èµ–é—®é¢˜

---

## ğŸ”„ å˜æ›´å†…å®¹

### 1. requirements.txt

**ä¿®æ”¹å‰**ï¼š
```python
# è¯­éŸ³æ’­æŠ¥ï¼ˆpyttsx3åœ¨Linuxéœ€è¦espeakç³»ç»Ÿä¾èµ–ï¼‰
pyttsx3==2.90
```

**ä¿®æ”¹å**ï¼š
```python
# è¯­éŸ³æ’­æŠ¥ï¼ˆç›´æ¥ä½¿ç”¨espeakï¼Œæ— éœ€PythonåŒ…ï¼‰
# æ³¨æ„ï¼šéœ€è¦ç³»ç»Ÿå®‰è£…espeakï¼šsudo apt-get install -y espeak espeak-data
```

### 2. src/alert/voice_alert.py

**æ ¸å¿ƒå˜æ›´**ï¼š
- ç§»é™¤äº†`import pyttsx3`ä¾èµ–
- æ”¹ç”¨`subprocess`æ¨¡å—ç›´æ¥è°ƒç”¨ç³»ç»Ÿespeakå‘½ä»¤
- ä¿æŒAPIæ¥å£ä¸å˜ï¼Œç¡®ä¿å…¼å®¹æ€§

**å…³é”®å®ç°**ï¼š

```python
import subprocess
import shutil
from threading import Lock, Thread

class VoiceAlert:
    def __init__(self, rate: int = 150, volume: float = 0.9, voice: str = "en"):
        # æ£€æŸ¥espeakæ˜¯å¦å®‰è£…
        self.espeak_available = shutil.which('espeak') is not None

        if not self.espeak_available:
            print("âš ï¸  espeakæœªå®‰è£…ï¼Œè¯­éŸ³æé†’å°†ä¸å¯ç”¨")
            return

    def speak(self, message: str, background: bool = True):
        # åå°çº¿ç¨‹æ’­æ”¾ï¼Œä¸é˜»å¡ä¸»ç¨‹åº
        if background:
            thread = Thread(target=self._speak_blocking, args=(message,))
            thread.daemon = True
            thread.start()

    def _speak_blocking(self, message: str):
        # ä½¿ç”¨subprocessè°ƒç”¨espeak
        cmd = [
            'espeak',
            '-s', str(self.rate),      # è¯­é€Ÿ
            '-a', str(self.volume),    # éŸ³é‡
            '-v', self.voice,          # è¯­è¨€
            message
        ]
        subprocess.run(cmd, timeout=10)
```

---

## âœ¨ æ–°ç‰¹æ€§å’Œæ”¹è¿›

### 1. è‡ªåŠ¨æ£€æµ‹espeakå®‰è£…çŠ¶æ€

```python
self.espeak_available = shutil.which('espeak') is not None

if not self.espeak_available:
    print("âš ï¸  espeakæœªå®‰è£…ï¼Œè¯­éŸ³æé†’å°†ä¸å¯ç”¨")
    print("   å®‰è£…æ–¹æ³•ï¼šsudo apt-get install -y espeak espeak-data")
```

- å¦‚æœæœªå®‰è£…espeakï¼Œç³»ç»Ÿä¼šå‹å¥½æç¤ºï¼Œä½†ä¸ä¼šå´©æºƒ
- è¯­éŸ³åŠŸèƒ½ä¼šä¼˜é›…é™çº§ä¸ºæ‰“å°æ¨¡å¼

### 2. åå°å¼‚æ­¥æ’­æ”¾

```python
def speak(self, message: str, background: bool = True):
    if background:
        thread = Thread(target=self._speak_blocking, args=(message,))
        thread.daemon = True
        thread.start()
```

- é»˜è®¤åœ¨åå°çº¿ç¨‹æ’­æ”¾è¯­éŸ³ï¼Œä¸é˜»å¡ä¸»ç¨‹åº
- ä¿è¯è§†é¢‘æµç•…åº¦ä¸å—å½±å“

### 3. è¶…æ—¶ä¿æŠ¤

```python
subprocess.run(cmd, timeout=10)
```

- 10ç§’è¶…æ—¶é™åˆ¶ï¼Œé˜²æ­¢è¯­éŸ³æ’­æ”¾å¡æ­»
- å¼‚å¸¸æƒ…å†µä¸‹è‡ªåŠ¨æ¢å¤

### 4. çº¿ç¨‹å®‰å…¨

```python
with self.lock:
    subprocess.run(cmd)
```

- ä½¿ç”¨Lockç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„è¯­éŸ³æ’­æ”¾ä¸å†²çª

---

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

| ç‰¹æ€§ | pyttsx3 | espeakï¼ˆæ–°æ–¹æ¡ˆï¼‰ |
|------|---------|-----------------|
| **è·¨å¹³å°æ€§** | âŒ ä¾èµ–pywin32ï¼ˆLinuxä¸å¯ç”¨ï¼‰ | âœ… LinuxåŸç”Ÿæ”¯æŒ |
| **å®‰è£…å¤æ‚åº¦** | âŒ éœ€è¦PythonåŒ…+ç³»ç»Ÿä¾èµ– | âœ… ä»…éœ€ç³»ç»Ÿä¾èµ– |
| **ä¾èµ–å¤§å°** | âŒ ~1MB PythonåŒ… | âœ… 0å­—èŠ‚PythonåŒ… |
| **å¯åŠ¨é€Ÿåº¦** | âš ï¸ éœ€è¦åˆå§‹åŒ–å¼•æ“ | âœ… ç›´æ¥è°ƒç”¨ï¼Œæ— åˆå§‹åŒ– |
| **å†…å­˜å ç”¨** | âš ï¸ å¸¸é©»Pythonå¼•æ“ | âœ… æŒ‰éœ€è°ƒç”¨ï¼Œå³ç”¨å³é‡Šæ”¾ |
| **ç¨³å®šæ€§** | âš ï¸ å¼•æ“å¯èƒ½å´©æºƒ | âœ… ç‹¬ç«‹è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åº |
| **é…ç½®çµæ´»æ€§** | âœ… Python API | âœ… å‘½ä»¤è¡Œå‚æ•° |
| **ç»´æŠ¤æˆæœ¬** | âŒ ä¾èµ–ç¬¬ä¸‰æ–¹åº“æ›´æ–° | âœ… ç³»ç»ŸåŒ…ç®¡ç†å™¨ç»´æŠ¤ |

---

## ğŸ“¦ å®‰è£…è¦æ±‚

### Ubuntu/Debianç³»ç»Ÿ

```bash
# å®‰è£…espeak
sudo apt-get update
sudo apt-get install -y espeak espeak-data

# éªŒè¯å®‰è£…
espeak --version

# æµ‹è¯•è¯­éŸ³
espeak "Hello, this is a test"
```

### æ ‘è“æ´¾OS

```bash
# espeaké€šå¸¸å·²é¢„è£…ï¼Œå¦‚æœªå®‰è£…ï¼š
sudo apt-get install -y espeak espeak-data
```

### æ£€æŸ¥å®‰è£…çŠ¶æ€

```python
import shutil
if shutil.which('espeak'):
    print("âœ… espeakå·²å®‰è£…")
else:
    print("âŒ espeakæœªå®‰è£…")
```

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•ï¼ˆä¸ä¹‹å‰å®Œå…¨ç›¸åŒï¼‰

```python
from alert.voice_alert import VoiceAlert

# åˆå§‹åŒ–
voice = VoiceAlert(rate=150, volume=0.9)

# æ’­æ”¾è¯­éŸ³ï¼ˆåå°å¼‚æ­¥ï¼‰
voice.speak("Hello, world!")

# æ’­æ”¾é¢„å®šä¹‰æé†’
voice.speak_alert('fatigue')  # æ’­æ”¾ç–²åŠ³æé†’
```

### é«˜çº§ç”¨æ³•

```python
# é˜»å¡å¼æ’­æ”¾ï¼ˆç­‰å¾…æ’­æ”¾å®Œæˆï¼‰
voice.speak("Important message", background=False)

# è‡ªå®šä¹‰è¯­éŸ³å‚æ•°
voice = VoiceAlert(
    rate=180,       # æ›´å¿«çš„è¯­é€Ÿ
    volume=1.0,     # æœ€å¤§éŸ³é‡
    voice="en-us"   # ç¾å¼è‹±è¯­
)

# æµ‹è¯•è¯­éŸ³åŠŸèƒ½
voice.test()
```

### espeakå‘½ä»¤è¡Œå‚æ•°

```bash
# åŸºæœ¬è¯­æ³•
espeak [é€‰é¡¹] "æ–‡æœ¬"

# å¸¸ç”¨é€‰é¡¹
-s <é€Ÿåº¦>    # è¯­é€Ÿï¼Œé»˜è®¤175ï¼ˆèŒƒå›´80-450ï¼‰
-a <éŸ³é‡>    # éŸ³é‡ï¼Œé»˜è®¤100ï¼ˆèŒƒå›´0-200ï¼‰
-v <è¯­éŸ³>    # è¯­è¨€/è¯­éŸ³ï¼Œå¦‚enã€en-usã€zhç­‰
-p <éŸ³è°ƒ>    # éŸ³è°ƒï¼Œé»˜è®¤50ï¼ˆèŒƒå›´0-99ï¼‰
-g <é—´éš”>    # å•è¯é—´éš”ï¼Œé»˜è®¤0ï¼ˆæ¯«ç§’ï¼‰

# ç¤ºä¾‹
espeak -s 150 -a 90 -v en "Hello, world!"
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. å•å…ƒæµ‹è¯•

```bash
# æµ‹è¯•è¯­éŸ³æ¨¡å—
cd src/alert
python voice_alert.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== è¯­éŸ³æé†’å™¨ç‹¬ç«‹æµ‹è¯• ===

âœ“ è¯­éŸ³æé†’å™¨åˆå§‹åŒ–æˆåŠŸï¼ˆespeakï¼‰
  - è¯­é€Ÿ: 150 wpm
  - éŸ³é‡: 90%
  - è¯­éŸ³: en

=== è¯­éŸ³æé†’æµ‹è¯• ===
æµ‹è¯• 1/3: System initialized successfully.
âœ“ è¯­éŸ³æé†’æ’­æ”¾å®Œæˆ: System initialized successfully.
...
```

### 2. é›†æˆæµ‹è¯•

```bash
# è¿è¡Œä¸»ç¨‹åº
python main.py
```

**éªŒè¯ç‚¹**ï¼š
- âœ… ç³»ç»Ÿåˆå§‹åŒ–æ—¶ä¸æŠ¥é”™
- âœ… è§¦å‘è­¦æŠ¥æ—¶èƒ½å¬åˆ°è¯­éŸ³
- âœ… è¯­éŸ³æ’­æ”¾ä¸å½±å“è§†é¢‘æµç•…åº¦

### 3. espeakå‘½ä»¤æµ‹è¯•

```bash
# æµ‹è¯•espeakå®‰è£…
which espeak
# è¾“å‡ºï¼š/usr/bin/espeak

# æµ‹è¯•è¯­éŸ³æ’­æ”¾
espeak "This is a test"

# æµ‹è¯•ä¸­æ–‡è¯­éŸ³ï¼ˆå¦‚æœæ”¯æŒï¼‰
espeak -v zh "ä½ å¥½ä¸–ç•Œ"
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. espeakå¿…é¡»é¢„å…ˆå®‰è£…

**é—®é¢˜**ï¼šå¦‚æœæœªå®‰è£…espeakï¼Œè¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# è¿è¡Œå®‰è£…è„šæœ¬
./install_ubuntu_deps.sh

# æˆ–æ‰‹åŠ¨å®‰è£…
sudo apt-get install -y espeak espeak-data
```

### 2. éŸ³é¢‘è¾“å‡ºè®¾å¤‡

**é—®é¢˜**ï¼šç³»ç»Ÿå¯èƒ½æ²¡æœ‰éŸ³é¢‘è¾“å‡ºè®¾å¤‡ï¼ˆå¦‚æœåŠ¡å™¨ç¯å¢ƒï¼‰

**è¡¨ç°**ï¼š
- espeakå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½†å¬ä¸åˆ°å£°éŸ³
- ä¸ä¼šäº§ç”Ÿé”™è¯¯ï¼Œåªæ˜¯æ— å£°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥éŸ³é¢‘è®¾å¤‡
aplay -l

# æµ‹è¯•éŸ³é¢‘è¾“å‡º
speaker-test -c 2 -t wav

# è°ƒæ•´éŸ³é‡
alsamixer
```

### 3. è¯­éŸ³è´¨é‡

**espeakç‰¹ç‚¹**ï¼š
- âœ… è½»é‡çº§ã€å¿«é€Ÿ
- âš ï¸ è¯­éŸ³è´¨é‡ä¸å¦‚å•†ä¸šTTSï¼ˆç•¥æ˜¾æœºæ¢°ï¼‰
- âœ… å¯¹äºç®€çŸ­è­¦æŠ¥æ¶ˆæ¯å®Œå…¨å¤Ÿç”¨

**å¦‚éœ€æ›´å¥½éŸ³è´¨**ï¼š
- å¯è€ƒè™‘ä½¿ç”¨`festival`ï¼ˆä½“ç§¯è¾ƒå¤§ï¼‰
- æˆ–ä½¿ç”¨äº‘ç«¯TTSæœåŠ¡ï¼ˆéœ€è¦ç½‘ç»œï¼‰

### 4. å¤šè¯­è¨€æ”¯æŒ

```bash
# æŸ¥çœ‹æ”¯æŒçš„è¯­è¨€
espeak --voices

# å¸¸ç”¨è¯­è¨€ä»£ç 
en       # è‹±è¯­
en-us    # ç¾å¼è‹±è¯­
en-gb    # è‹±å¼è‹±è¯­
zh       # ä¸­æ–‡ï¼ˆæ”¯æŒæœ‰é™ï¼‰
es       # è¥¿ç­ç‰™è¯­
fr       # æ³•è¯­
de       # å¾·è¯­
```

---

## ğŸ”„ è¿ç§»æ£€æŸ¥æ¸…å•

å¦‚æœæ‚¨ä»æ—§ç‰ˆæœ¬å‡çº§ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] å·²åˆ é™¤`pyttsx3`ä¾èµ–ï¼š`pip uninstall pyttsx3`
- [ ] å·²å®‰è£…espeakï¼š`sudo apt-get install espeak`
- [ ] å·²æ›´æ–°requirements.txt
- [ ] å·²æ›´æ–°voice_alert.py
- [ ] è¿è¡Œæµ‹è¯•ç¡®è®¤è¯­éŸ³åŠŸèƒ½æ­£å¸¸
- [ ] ä¸»ç¨‹åºèƒ½æ­£å¸¸æ’­æ”¾è­¦æŠ¥è¯­éŸ³
- [ ] è¯­éŸ³æ’­æ”¾ä¸é˜»å¡è§†é¢‘æµ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Ubuntuç³»ç»Ÿä¾èµ–æŒ‡å—](./Ubuntuç³»ç»Ÿä¾èµ–æŒ‡å—.md) - å®Œæ•´çš„ç³»ç»Ÿä¾èµ–å®‰è£…è¯´æ˜
- [espeakå®˜æ–¹æ–‡æ¡£](http://espeak.sourceforge.net/) - espeakå‘½ä»¤è¡Œæ‰‹å†Œ
- [requirements.txt](../requirements.txt) - é¡¹ç›®ä¾èµ–æ¸…å•

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è¯­éŸ³æ’­æ”¾æ²¡æœ‰å£°éŸ³ï¼Ÿ

**A1**ï¼šæ£€æŸ¥ä¸‰ä¸ªæ–¹é¢
```bash
# 1. espeakæ˜¯å¦å®‰è£…
which espeak

# 2. éŸ³é¢‘è®¾å¤‡æ˜¯å¦æ­£å¸¸
speaker-test -c 2

# 3. éŸ³é‡æ˜¯å¦é™éŸ³
alsamixer
```

### Q2: æç¤º"espeakæœªå®‰è£…"ï¼Ÿ

**A2**ï¼šå®‰è£…espeak
```bash
sudo apt-get update
sudo apt-get install -y espeak espeak-data
```

### Q3: è¯­éŸ³æ’­æ”¾å¾ˆå¡é¡¿ï¼Ÿ

**A3**ï¼šä½¿ç”¨åå°å¼‚æ­¥æ¨¡å¼ï¼ˆé»˜è®¤å·²å¯ç”¨ï¼‰
```python
voice.speak("message", background=True)  # ä¸é˜»å¡
```

### Q4: èƒ½å¦ä½¿ç”¨å…¶ä»–TTSå¼•æ“ï¼Ÿ

**A4**ï¼šå¯ä»¥ï¼ä¿®æ”¹voice_alert.pyä¸­çš„å‘½ä»¤å³å¯
```python
# ä¾‹å¦‚ä½¿ç”¨festival
cmd = ['festival', '--tts', message]

# æˆ–ä½¿ç”¨pico2wave
cmd = ['pico2wave', '-w', '/tmp/temp.wav', message]
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### å¯åŠ¨æ—¶é—´

| æ–¹æ¡ˆ | é¦–æ¬¡è°ƒç”¨ | åç»­è°ƒç”¨ |
|------|---------|---------|
| pyttsx3 | ~500ms | ~100ms |
| espeakï¼ˆæ–°ï¼‰ | ~50ms | ~50ms |

### å†…å­˜å ç”¨

| æ–¹æ¡ˆ | å¸¸é©»å†…å­˜ | æ’­æ”¾æ—¶ |
|------|---------|--------|
| pyttsx3 | ~10MB | ~15MB |
| espeakï¼ˆæ–°ï¼‰ | 0MB | ~3MB |

### CPUå ç”¨

| æ–¹æ¡ˆ | æ’­æ”¾æ—¶CPU | ç©ºé—²æ—¶CPU |
|------|----------|----------|
| pyttsx3 | ~15% | ~2% |
| espeakï¼ˆæ–°ï¼‰ | ~10% | 0% |

---

## âœ… æ€»ç»“

### ä¸»è¦ä¼˜åŠ¿

1. âœ… **è§£å†³äº†pywin32ä¾èµ–é—®é¢˜** - Ubuntuå®Œç¾å…¼å®¹
2. âœ… **ç®€åŒ–äº†ä¾èµ–ç®¡ç†** - æ— éœ€PythonåŒ…
3. âœ… **æå‡äº†æ€§èƒ½** - æ›´å¿«ã€æ›´çœèµ„æº
4. âœ… **å¢å¼ºäº†ç¨³å®šæ€§** - ç‹¬ç«‹è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åº
5. âœ… **ä¿æŒäº†APIå…¼å®¹æ€§** - æ— éœ€ä¿®æ”¹ä¸Šå±‚ä»£ç 

### æ³¨æ„äº‹é¡¹

1. âš ï¸ éœ€è¦é¢„å…ˆå®‰è£…espeakç³»ç»ŸåŒ…
2. âš ï¸ è¯­éŸ³è´¨é‡ç•¥æ˜¾æœºæ¢°ï¼ˆå¯¹è­¦æŠ¥æ¶ˆæ¯å½±å“ä¸å¤§ï¼‰
3. âš ï¸ éœ€è¦éŸ³é¢‘è¾“å‡ºè®¾å¤‡

### å»ºè®®

- âœ… **æ¨èä½¿ç”¨** - å¯¹äºUbuntu/Linuxéƒ¨ç½²
- âœ… **é€‚åˆåœºæ™¯** - ç®€çŸ­è­¦æŠ¥æ¶ˆæ¯ã€ç¦»çº¿ç¯å¢ƒ
- âš ï¸ **ä¸é€‚åˆåœºæ™¯** - éœ€è¦é«˜è´¨é‡è¯­éŸ³åˆæˆçš„åº”ç”¨

---

**æœ€åæ›´æ–°**ï¼š2024å¹´11æœˆ
**ç»´æŠ¤è€…**ï¼šé¡¹ç›®å¼€å‘å›¢é˜Ÿ
